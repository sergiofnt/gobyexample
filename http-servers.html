<!DOCTYPE html>
<html>
<head>
	<meta http-eqiv="content-type" content="text/html;charset=utf-8" />
	<title>Go за Прикладом: HTTP Сервери</title>
	<link rel=stylesheet href="site.css" />
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75170058-3"></script>
	<script type="text/javascript">
	if (window.location.host == "gobyexample.com.ua") {
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js',      new Date());
		gtag('config', 'UA-75170058-3');
	}
	</script>
    <script>
      onkeydown = (e) => {
          
          if (e.key == "ArrowLeft") {
              window.location.href = 'http-clients';
          }
          
          
          if (e.key == "ArrowRight") {
              window.location.href = 'spawning-processes';
          }
          
      }
  </script>
</head>
<body>
	<div class="example" id="http-servers">
	<h2><a href="./">Go за Прикладом</a>: HTTP Сервери</h2>
	
	<table>
		
		<tr>
			<td class="docs"><p>Написання HTTP-серверу не є складною задачою,
за умови використання пакет <code>net/http</code>.</p>
</td>
			<td class="code leading">
			<a href="http://play.golang.org/p/yUgXyKjcOR1"><img title="Run code" src="play.png" class="run" /></a><img title="Copy code" src="clipboard.png" class="copy" />
			<div class="highlight"><pre><span class="kn">package</span> <span class="nx">main</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"></td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>Фундаментальним концептом у серверах <code>net/http</code> є обробники (handlers)
Обробник - це об&rsquo;єкт, що імплементує інтерфейс <code>http.Handler</code>.
Зазвичай, для написання обробника використовується адаптер <code>http.HandlerFunc</code>
з функціює відповідної сигнатури.</p>
</td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="kd">func</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>Функції що використовуються як обробники - приймають
<code>http.ResponseWriter</code> і вказівник на <code>http.Request</code> як аргументи.
<code>http.ResponseWriter</code> використовується для запису HTTP-відповіді
В цьому прикладі - відповіддю є рядок &ldquo;hello\n&rdquo;.</p>
</td>
			<td class="code leading">
			
			<div class="highlight"><pre>    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;hello\n&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"></td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="kd">func</span> <span class="nx">headers</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>В даному обробнику проводиться зчитування HTTP-заголовків,
і передавання їх як відповідь клієнту.</p>
</td>
			<td class="code leading">
			
			<div class="highlight"><pre>    <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">headers</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Header</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">h</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">headers</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;%v: %v\n&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"></td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>Дані рядки реєструють маршрути, які потрібно обслужити серверу,
за допомогою функції <code>http.HandleFunc</code>. Ця функція
встановлює маршрутизатор по замовчуванню і обробник який буде виконано,
якщо буде зроблено запит по вказаних маршрутах.</p>
</td>
			<td class="code leading">
			
			<div class="highlight"><pre>    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">,</span> <span class="nx">hello</span><span class="p">)</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/headers&quot;</span><span class="p">,</span> <span class="nx">headers</span><span class="p">)</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>Запускаємо HTTP-сервер. В якості порту, на якому очікуються з&rsquo;єднання
встановлено &ldquo;:8090&rdquo;. Другий параметр вказує на те, що потрібно використовувати
маршрутизатор по замовчуванню, який було заздалегідь встановлено.</p>
</td>
			<td class="code">
			
			<div class="highlight"><pre>    <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8090&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

			</td>
		</tr>
	
	</table>
	
	<table>
		
		<tr>
			<td class="docs"><p>Запустити сервер в фоновому режимі</p>
</td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="go">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"></td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="gp">$</span> go run http-servers.go <span class="p">&amp;</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>Зробити запит до маршруту &ldquo;hello&rdquo;</p>
</td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="gp">$</span> curl localhost:8090/hello
<span class="go">hello</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>Завершимо наш сервер</p>
</td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="gp">$</span> <span class="nb">kill</span> -9 <span class="nv">$!</span>
<span class="go">=======</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>Run the server in the background.</p>
</td>
			<td class="code leading">
			
			<div class="highlight"><pre><span class="gp">$</span> go run http-servers.go <span class="p">&amp;</span>
</pre></div>

			</td>
		</tr>
	
		<tr>
			<td class="docs"><p>Access the <code>/hello</code> route.</p>
</td>
			<td class="code">
			
			<div class="highlight"><pre><span class="gp">$</span> curl localhost:8090/hello
<span class="go">hello</span>
<span class="gp">&gt;</span>&gt;&gt;&gt;&gt;&gt;&gt; master
</pre></div>

			</td>
		</tr>
	
	</table>
	


	<p class="next">
		Наступний приклад: <a href="spawning-processes.html">Запуск сторонніх процесів</a>.
	</p>

<p class="footer">
Автор <a href="https://twitter.com/mmcgrana">@mmcgrana</a> | Переклад <a href="https://twitter.com/butuzov">@butuzov</a> | <a href="https://github.com/butuzov/gobyexample/blob/ukrainian/examples/http-servers">source</a> | <a href="https://github.com/butuzov/gobyexample#license">ліцензія</a>
</p>

    <script>
      var codeLines = [];
      codeLines.push('package main\u000A');codeLines.push('import (\u000A    \"fmt\"\u000A    \"net/http\"\u000A)\u000A');codeLines.push('func hello(w http.ResponseWriter, req *http.Request) {\u000A');codeLines.push('    fmt.Fprintf(w, \"hello\\n\")\u000A}\u000A');codeLines.push('func headers(w http.ResponseWriter, req *http.Request) {\u000A');codeLines.push('    for name, headers := range req.Header {\u000A        for _, h := range headers {\u000A            fmt.Fprintf(w, \"%v: %v\\n\", name, h)\u000A        }\u000A    }\u000A}\u000A');codeLines.push('func main() {\u000A');codeLines.push('    http.HandleFunc(\"/hello\", hello)\u000A    http.HandleFunc(\"/headers\", headers)\u000A');codeLines.push('    http.ListenAndServe(\":8090\", nil)\u000A}\u000A');codeLines.push('');codeLines.push('');codeLines.push('');codeLines.push('');codeLines.push('');codeLines.push('');
    </script>
    <script src="site.js" async></script>

</div>
</body>
</html>
